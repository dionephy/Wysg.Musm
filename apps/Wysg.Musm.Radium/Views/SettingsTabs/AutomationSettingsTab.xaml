<UserControl x:Class="Wysg.Musm.Radium.Views.SettingsTabs.AutomationSettingsTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900">
    <UserControl.Resources>
        <!-- DataTemplates for automation modules -->
        <DataTemplate x:Key="OrderedModuleTemplate">
            <Border BorderBrush="{DynamicResource BrushBorder}" BorderThickness="1" CornerRadius="2" Padding="4" Margin="0,2,0,2" Background="{DynamicResource BrushSurfaceAlt}">
                <DockPanel>
                    <Button Content="X" DockPanel.Dock="Right" Width="22" Height="22" Margin="4,0,0,0" Padding="0" CommandParameter="{Binding}" Tag="removeBtn" ToolTip="Remove module" Click="OnRemoveModuleClick"/>
                    <TextBlock Text="{Binding}"/>
                </DockPanel>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="LibraryModuleTemplate">
            <Border BorderBrush="{DynamicResource BrushBorder}" BorderThickness="1" CornerRadius="2" Padding="4" Margin="0,2,0,2" Background="{DynamicResource BrushSurface}">
                <TextBlock Text="{Binding}"/>
            </Border>
        </DataTemplate>
    </UserControl.Resources>
    
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Stretch">
            <TextBlock Text="Drag modules between panes to configure execution order (duplicates allowed)." FontWeight="Bold" Foreground="{DynamicResource BrushTextPrimary}"/>
            <TextBlock Text="  |  " Margin="8,0" Foreground="{DynamicResource BrushTextSecondary}"/>
            <TextBlock Text="PACS: " Foreground="{DynamicResource BrushTextSecondary}"/>
            <TextBlock x:Name="txtCurrentPacsKey" Foreground="{DynamicResource BrushTextPrimary}"/>
        </StackPanel>
        
        <Grid Grid.Row="1" Margin="0,8,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <Border Grid.Row="0" Grid.Column="0" BorderBrush="{DynamicResource BrushBorder}" BorderThickness="1" CornerRadius="4" Padding="6" Background="{DynamicResource BrushSurface}" Margin="0,0,8,8">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="New Study" FontWeight="SemiBold" Margin="0,0,0,4" Foreground="{DynamicResource BrushTextPrimary}"/>
                    <ListBox x:Name="lstNewStudy" AllowDrop="True" PreviewMouseMove="OnProcDrag" Drop="OnProcDrop" DragLeave="OnListDragLeave" Tag="NewStudy" ItemTemplate="{StaticResource OrderedModuleTemplate}"/>
                </DockPanel>
            </Border>
            
            <Border Grid.Row="0" Grid.Column="1" BorderBrush="{DynamicResource BrushBorder}" BorderThickness="1" CornerRadius="4" Padding="6" Background="{DynamicResource BrushSurface}" Margin="0,0,8,8">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Add Study" FontWeight="SemiBold" Margin="0,0,0,4" Foreground="{DynamicResource BrushTextPrimary}"/>
                    <ListBox x:Name="lstAddStudy" AllowDrop="True" PreviewMouseMove="OnProcDrag" Drop="OnProcDrop" DragLeave="OnListDragLeave" Tag="AddStudy" ItemTemplate="{StaticResource OrderedModuleTemplate}"/>
                </DockPanel>
            </Border>
            
            <Border Grid.Row="0" Grid.Column="2" BorderBrush="{DynamicResource BrushBorder}" BorderThickness="1" CornerRadius="4" Padding="6" Background="{DynamicResource BrushSurface}">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Available Modules" FontWeight="SemiBold" Margin="0,0,0,4" Foreground="{DynamicResource BrushTextPrimary}"/>
                    <ListBox x:Name="lstLibrary" PreviewMouseMove="OnProcDrag" DragLeave="OnListDragLeave" Tag="Library" ItemTemplate="{StaticResource LibraryModuleTemplate}"/>
                </DockPanel>
            </Border>

            <!-- Shortcut panes -->
            <Border Grid.Row="1" Grid.Column="0" BorderBrush="{DynamicResource BrushBorder}" BorderThickness="1" CornerRadius="4" Padding="6" Background="{DynamicResource BrushSurface}" Margin="0,0,8,0">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Shortcut: Open study (new)" FontWeight="SemiBold" Margin="0,0,0,4" Foreground="{DynamicResource BrushTextPrimary}"/>
                    <ListBox x:Name="lstShortcutOpenNew" AllowDrop="True" PreviewMouseMove="OnProcDrag" Drop="OnProcDrop" DragLeave="OnListDragLeave" Tag="ShortcutOpenNew" ItemTemplate="{StaticResource OrderedModuleTemplate}"/>
                </DockPanel>
            </Border>
            
            <Border Grid.Row="1" Grid.Column="1" BorderBrush="{DynamicResource BrushBorder}" BorderThickness="1" CornerRadius="4" Padding="6" Background="{DynamicResource BrushSurface}" Margin="0,0,8,0">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Shortcut: Open study (add)" FontWeight="SemiBold" Margin="0,0,0,4" Foreground="{DynamicResource BrushTextPrimary}"/>
                    <ListBox x:Name="lstShortcutOpenAdd" AllowDrop="True" PreviewMouseMove="OnProcDrag" Drop="OnProcDrop" DragLeave="OnListDragLeave" Tag="ShortcutOpenAdd" ItemTemplate="{StaticResource OrderedModuleTemplate}"/>
                </DockPanel>
            </Border>
            
            <Border Grid.Row="1" Grid.Column="2" BorderBrush="{DynamicResource BrushBorder}" BorderThickness="1" CornerRadius="4" Padding="6" Background="{DynamicResource BrushSurface}">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Shortcut: Open study (after open)" FontWeight="SemiBold" Margin="0,0,0,4" Foreground="{DynamicResource BrushTextPrimary}"/>
                    <ListBox x:Name="lstShortcutOpenAfterOpen" AllowDrop="True" PreviewMouseMove="OnProcDrag" Drop="OnProcDrop" DragLeave="OnListDragLeave" Tag="ShortcutOpenAfterOpen" ItemTemplate="{StaticResource OrderedModuleTemplate}"/>
                </DockPanel>
            </Border>
        </Grid>
        
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <Button Content="Save Automation" Command="{Binding SaveAutomationCommand}" Width="140" Margin="0,0,8,0"/>
            <Button Content="Spy" Width="90" Margin="0,0,8,0" Click="OnOpenSpy"/>
            <Button Content="Close" Width="90" IsCancel="True"/>
        </StackPanel>
    </Grid>
</UserControl>
