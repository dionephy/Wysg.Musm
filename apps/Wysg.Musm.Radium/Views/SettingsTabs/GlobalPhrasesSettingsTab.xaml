<UserControl x:Class="Wysg.Musm.Radium.Views.SettingsTabs.GlobalPhrasesSettingsTab"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:views="clr-namespace:Wysg.Musm.Radium.Views">
    <UserControl.Resources>
        <!-- Converters needed for this tab -->
        <views:ActiveToButtonTextConverter x:Key="ActiveToButtonTextConverter"/>
        <views:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Grid Margin="8" Loaded="OnLoaded">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with SNOMED Browser and Word Count Importer Buttons -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
          <Grid.ColumnDefinitions>
      <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

   <TextBlock Grid.Column="0"
        Text="Global Phrases (Available to All Accounts)" 
              FontSize="16" 
          FontWeight="Bold" 
    Foreground="{DynamicResource BrushTextPrimary}"
   VerticalAlignment="Center"/>

            <Button Grid.Column="1"
        Content="? Browse SNOMED CT"
  Click="OnOpenSnomedBrowserClick"
    Padding="12,6"
      MinWidth="180"
           FontSize="14"
    Margin="0,0,8,0"
 ToolTip="Open SNOMED CT Browser - Browse all concepts by domain with pagination"/>

  <Button Grid.Column="2"
 Content="? Import by Word Count"
  Click="OnOpenWordCountImporterClick"
         Padding="12,6"
              MinWidth="180"
        FontSize="14"
       ToolTip="Import SNOMED CT concepts filtered by word count - Add/Ignore single-word synonyms"/>
        </Grid>

        <!-- Add New Phrase Section -->
        <Border Grid.Row="1" 
                BorderBrush="{DynamicResource BrushBorder}" 
                BorderThickness="1" 
                Padding="10" 
                Margin="0,0,0,10"
                Background="{DynamicResource BrushSurfaceAlt}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Quick Add (no SNOMED) -->
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="Quick Add:" 
                               VerticalAlignment="Center" 
                               Foreground="{DynamicResource BrushTextPrimary}"
                               Margin="0,0,10,0"/>

                    <TextBox Grid.Column="1" 
                             Text="{Binding NewPhraseText, UpdateSourceTrigger=PropertyChanged}"
                             VerticalAlignment="Center"
                             Padding="5"
                             Margin="0,0,10,0">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding AddPhraseCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <Button Grid.Column="2" 
                            Content="Add (No SNOMED)" 
                            Command="{Binding AddPhraseCommand}"
                            Padding="10,5"
                            MinWidth="130"/>
                </Grid>

                <!-- Add with SNOMED Search -->
                <Expander Grid.Row="1" Header="Add with SNOMED CT Mapping (Single)" IsExpanded="False"
                          Background="{DynamicResource BrushSurface}"
                          Foreground="{DynamicResource BrushTextPrimary}"
                          BorderBrush="{DynamicResource BrushBorder}"
                          Margin="0,0,0,8">
                    <Grid Margin="0,8,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="200"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Search Box -->
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Search SNOMED:" 
                                       VerticalAlignment="Center" 
                                       Foreground="{DynamicResource BrushTextPrimary}"
                                       Margin="0,0,10,0"/>

                            <TextBox Grid.Column="1" 
                                     x:Name="txtSnomedSearch"
                                     Text="{Binding SnomedSearchText, UpdateSourceTrigger=PropertyChanged}"
                                     VerticalAlignment="Center"
                                     Padding="5"
                                     Margin="0,0,10,0">
                                <TextBox.InputBindings>
                                    <KeyBinding Key="Enter" Command="{Binding SearchSnomedCommand}"/>
                                </TextBox.InputBindings>
                            </TextBox>

                            <Button Grid.Column="2" 
                                    Content="Search" 
                                    Command="{Binding SearchSnomedCommand}"
                                    Padding="10,5"
                                    MinWidth="80"/>
                        </Grid>

                        <!-- Selected Concept Display -->
                        <Border Grid.Row="1" 
                                BorderBrush="{DynamicResource BrushBorder}" 
                                BorderThickness="1" 
                                Padding="8" 
                                Margin="0,0,0,8"
                                Background="{DynamicResource BrushSurface}"
                                Visibility="{Binding HasSelectedConcept, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" 
                                           Text="Selected:" 
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource BrushTextPrimary}"
                                           Margin="0,0,10,0"/>

                                <TextBlock Grid.Column="1" 
                                           Text="{Binding SelectedConceptDisplay}"
                                           Foreground="#90EE90"
                                           TextWrapping="Wrap"/>
                            </Grid>
                        </Border>

                        <!-- Search Results -->
                        <DataGrid Grid.Row="2" 
                                  ItemsSource="{Binding SnomedSearchResults}"
                                  SelectedItem="{Binding SelectedSnomedConcept}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  SelectionMode="Single"
                                  HeadersVisibility="Column"
                                  RowHeaderWidth="0"
                                  IsReadOnly="True"
                                  Background="{DynamicResource BrushSurface}"
                                  Foreground="{DynamicResource BrushTextPrimary}"
                                  BorderBrush="{DynamicResource BrushBorder}"
                                  RowBackground="{DynamicResource BrushSurface}"
                                  AlternatingRowBackground="{DynamicResource BrushSurfaceAlt}"
                                  Margin="0,0,0,8">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="{DynamicResource BrushSurfaceAlt}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource BrushTextPrimary}"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource BrushBorder}"/>
                                    <Setter Property="BorderThickness" Value="0 0 1 1"/>
                                    <Setter Property="Padding" Value="6 4"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Concept ID" Binding="{Binding ConceptIdStr}" Width="120"/>
                                <DataGridTextColumn Header="FSN (Fully Specified Name)" Binding="{Binding Fsn}" Width="*"/>
                                <DataGridTextColumn Header="PT (Preferred Term)" Binding="{Binding Pt}" Width="250"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Add Button -->
                        <Button Grid.Row="3" 
                                Content="Add Phrase with Selected SNOMED Mapping" 
                                Command="{Binding AddPhraseWithSnomedCommand}"
                                Padding="10,5"
                                HorizontalAlignment="Right"
                                MinWidth="280"/>
                    </Grid>
                </Expander>

                <!-- Bulk Add with SNOMED Search -->
                <Expander Grid.Row="2" Header="Bulk Add with SNOMED CT (Multiple Selection)" IsExpanded="False"
                          Background="{DynamicResource BrushSurface}"
                          Foreground="{DynamicResource BrushTextPrimary}"
                          BorderBrush="{DynamicResource BrushBorder}">
                    <Grid Margin="0,8,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="300"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Search Box with Filters -->
                        <Border Grid.Row="0" 
                                BorderBrush="{DynamicResource BrushBorder}" 
                                BorderThickness="1" 
                                Padding="10" 
                                Margin="0,0,0,8"
                                Background="{DynamicResource BrushSurface}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Search Text -->
                                <TextBlock Grid.Row="0" Grid.Column="0" 
                                           Text="Search Term:" 
                                           VerticalAlignment="Center" 
                                           Foreground="{DynamicResource BrushTextPrimary}"
                                           Margin="0,0,10,0"/>

                                <TextBox Grid.Row="0" Grid.Column="1" 
                                         Text="{Binding BulkSnomedSearchText, UpdateSourceTrigger=PropertyChanged}"
                                         VerticalAlignment="Center"
                                         Padding="5"
                                         Margin="0,0,10,0">
                                    <TextBox.InputBindings>
                                        <KeyBinding Key="Enter" Command="{Binding BulkSearchSnomedCommand}"/>
                                    </TextBox.InputBindings>
                                </TextBox>

                                <Button Grid.Row="0" Grid.Column="2" 
                                        Content="Search (50 results)" 
                                        Command="{Binding BulkSearchSnomedCommand}"
                                        Padding="10,5"
                                        MinWidth="130"/>

                                <!-- Filter Options -->
                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" 
                                            Orientation="Horizontal" 
                                            Margin="0,8,0,0">
                                    <TextBlock Text="Filters:" 
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource BrushTextPrimary}"
                                               Margin="0,0,10,0"/>
                                    <CheckBox Content="Body Structure" 
                                              IsChecked="{Binding FilterBodyStructure}"
                                              Margin="0,0,15,0"/>
                                    <CheckBox Content="Finding" 
                                              IsChecked="{Binding FilterFinding}"
                                              Margin="0,0,15,0"/>
                                    <CheckBox Content="Disorder" 
                                              IsChecked="{Binding FilterDisorder}"
                                              Margin="0,0,15,0"/>
                                    <CheckBox Content="Procedure" 
                                              IsChecked="{Binding FilterProcedure}"
                                              Margin="0,0,15,0"/>
                                    <CheckBox Content="Active Only" 
                                              IsChecked="{Binding FilterActiveOnly}"
                                              IsEnabled="False"
                                              ToolTip="Always enabled - Snowstorm returns active concepts by default"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Selection Summary with Pagination -->
                        <Border Grid.Row="1" 
                                BorderBrush="{DynamicResource BrushBorder}" 
                                BorderThickness="1" 
                                Padding="8" 
                                Margin="0,0,0,8"
                                Background="{DynamicResource BrushSurface}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" 
                                           Text="{Binding BulkSelectionSummary}" 
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource BrushTextPrimary}"
                                           VerticalAlignment="Center"/>

                                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="? Previous" 
                                            Command="{Binding PreviousPageCommand}"
                                            Padding="8,4"
                                            MinWidth="80"
                                            Margin="0,0,8,0"/>
                                    
                                    <TextBlock Text="{Binding PageInfo}" 
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource BrushTextPrimary}"
                                               Margin="8,0"/>
                                    
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0">
                                        <TextBlock Text="Page size:" 
                                                   VerticalAlignment="Center"
                                                   Foreground="{DynamicResource BrushTextPrimary}"
                                                   Margin="0,0,4,0"/>
                                        <TextBox Text="{Binding PageSize, UpdateSourceTrigger=PropertyChanged}" 
                                                 Width="40"
                                                 VerticalAlignment="Center"
                                                 Padding="2"/>
                                    </StackPanel>
                                    
                                    <Button Content="Next ?" 
                                            Command="{Binding NextPageCommand}"
                                            Padding="8,4"
                                            MinWidth="80"
                                            Margin="8,0,0,0"/>
                                </StackPanel>

                                <Button Grid.Column="3" 
                                        Content="Select All (Page)" 
                                        Command="{Binding SelectAllBulkResultsCommand}"
                                        Padding="8,4"
                                        MinWidth="120"
                                        Margin="8,0,0,0"/>
                            </Grid>
                        </Border>

                        <!-- Bulk Search Results with Checkboxes -->
                        <DataGrid Grid.Row="2" 
                                  ItemsSource="{Binding BulkSnomedSearchResults}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  HeadersVisibility="Column"
                                  RowHeaderWidth="0"
                                  Background="{DynamicResource BrushSurface}"
                                  Foreground="{DynamicResource BrushTextPrimary}"
                                  BorderBrush="{DynamicResource BrushBorder}"
                                  RowBackground="{DynamicResource BrushSurface}"
                                  AlternatingRowBackground="{DynamicResource BrushSurfaceAlt}"
                                  Margin="0,0,0,8">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="{DynamicResource BrushSurfaceAlt}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource BrushTextPrimary}"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource BrushBorder}"/>
                                    <Setter Property="BorderThickness" Value="0 0 1 1"/>
                                    <Setter Property="Padding" Value="6 4"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="Select" Width="60">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                      HorizontalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Concept ID" Binding="{Binding Concept.ConceptIdStr}" Width="120" IsReadOnly="True"/>
                                <DataGridTextColumn Header="FSN (Fully Specified Name)" Binding="{Binding Concept.Fsn}" Width="*" IsReadOnly="True"/>
                                <DataGridTextColumn Header="PT (Preferred Term)" Binding="{Binding Concept.Pt}" Width="250" IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Bulk Add Button -->
                        <Button Grid.Row="3" 
                                Content="Add Selected Phrases with SNOMED Mappings" 
                                Command="{Binding BulkAddPhrasesWithSnomedCommand}"
                                Padding="10,5"
                                HorizontalAlignment="Right"
                                MinWidth="300"/>
                    </Grid>
                </Expander>
            </Grid>
        </Border>

        <!-- Account Phrase Conversion Section -->
        <Border Grid.Row="3"
                BorderBrush="{DynamicResource BrushBorder}"
                BorderThickness="1"
                Padding="10"
                Margin="0,0,0,10"
                Background="{DynamicResource BrushSurface}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="200"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Account phrases list -->
                <DataGrid Grid.Row="0" Grid.ColumnSpan="2"
                          ItemsSource="{Binding AccountPhrases}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False" CanUserDeleteRows="False"
                          IsReadOnly="False"
                          Background="{DynamicResource BrushSurface}"
                          Foreground="{DynamicResource BrushTextPrimary}"
                          BorderBrush="{DynamicResource BrushBorder}"
                          RowBackground="{DynamicResource BrushSurface}"
                          AlternatingRowBackground="{DynamicResource BrushSurfaceAlt}"
                          HeadersVisibility="Column"
                          RowHeaderWidth="0">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="Select" Width="70" IsReadOnly="False">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Center"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="AccountId" Binding="{Binding AccountId}" Width="100" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Text" Binding="{Binding Text}" Width="*" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Active" Binding="{Binding Active}" Width="70" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Id" Binding="{Binding Id}" Width="90" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Convert + Select All buttons -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                    <Button Content="Select All" Command="{Binding SelectAllAccountPhrasesCommand}"/>
                    <Button Content="Convert Selected to Global" Command="{Binding ConvertSelectedCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Global Phrases List -->
        <DataGrid Grid.Row="4" 
                  ItemsSource="{Binding Items}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  SelectionMode="Single"
                  HeadersVisibility="Column"
                  GridLinesVisibility="Horizontal"
                  RowHeaderWidth="0"
                  IsReadOnly="True"
                  Background="{DynamicResource BrushSurface}"
                  Foreground="{DynamicResource BrushTextPrimary}"
                  BorderBrush="{DynamicResource BrushBorder}"
                  RowBackground="{DynamicResource BrushSurface}"
                  AlternatingRowBackground="{DynamicResource BrushSurfaceAlt}">
            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="{DynamicResource BrushSurfaceAlt}"/>
                    <Setter Property="Foreground" Value="{DynamicResource BrushTextPrimary}"/>
                    <Setter Property="BorderBrush" Value="{DynamicResource BrushBorder}"/>
                    <Setter Property="BorderThickness" Value="0 0 1 1"/>
                    <Setter Property="Padding" Value="6 4"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>
            <DataGrid.Columns>
                <!-- Text Column with Edit Support -->
                <DataGridTemplateColumn Header="Phrase Text" Width="2*" MinWidth="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding Text}" 
                                          VerticalAlignment="Center"
                                          Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}"/>
                                <TextBox Text="{Binding EditText, UpdateSourceTrigger=PropertyChanged}" 
                                        VerticalAlignment="Center"
                                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}}"
                                        BorderThickness="1"
                                        BorderBrush="{DynamicResource BrushAccent}"
                                        Background="{DynamicResource BrushSurfaceAlt}"
                                        Foreground="{DynamicResource BrushTextPrimary}"
                                        Padding="4"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- SNOMED Mapping Column -->
                <DataGridTextColumn Header="SNOMED Mapping" 
                                    Binding="{Binding SnomedMappingText}" 
                                    Width="3*" 
                                    MinWidth="200">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="#A8E6CF"/>
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                            <Setter Property="ToolTip" Value="{Binding SnomedMappingText}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SnomedSemanticTag}" Value="body structure">
                                    <Setter Property="Foreground" Value="#90EE90"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SnomedSemanticTag}" Value="finding">
                                    <Setter Property="Foreground" Value="#ADD8E6"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SnomedSemanticTag}" Value="disorder">
                                    <Setter Property="Foreground" Value="#FFB3B3"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SnomedSemanticTag}" Value="procedure">
                                    <Setter Property="Foreground" Value="#FFFF99"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SnomedSemanticTag}" Value="observable entity">
                                    <Setter Property="Foreground" Value="#E0C4FF"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SnomedSemanticTag}" Value="substance">
                                    <Setter Property="Foreground" Value="#FFD580"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Active" Binding="{Binding Active}" Width="60"/>
                <DataGridTextColumn Header="Updated" Binding="{Binding UpdatedAtDisplay}" Width="150"/>
                <DataGridTextColumn Header="Rev" Binding="{Binding Rev}" Width="60"/>

                <!-- Actions Column -->
                <DataGridTemplateColumn Header="Actions" Width="340">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <!-- Edit Mode Buttons -->
                                <Button Content="Save"
                                        Command="{Binding SaveEditCommand}"
                                        Padding="5,2"
                                        MinWidth="60"
                                        Margin="0,0,4,0"
                                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <Button Content="Cancel"
                                        Command="{Binding CancelEditCommand}"
                                        Padding="5,2"
                                        MinWidth="60"
                                        Margin="0,0,4,0"
                                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                
                                <!-- Normal Mode Buttons -->
                                <Button Content="Edit"
                                        Command="{Binding EditCommand}"
                                        Padding="5,2"
                                        MinWidth="60"
                                        Margin="0,0,4,0"
                                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}"/>
                                <Button Content="{Binding Active, Converter={StaticResource ActiveToButtonTextConverter}}"
                                        Command="{Binding ToggleCommand}"
                                        Padding="5,2"
                                        MinWidth="80"
                                        Margin="0,0,4,0"
                                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}"/>
                                <Button Content="Link SNOMED" 
                                        Padding="5,2" 
                                        MinWidth="100"
                                        Click="OnLinkSnomedFromGlobal"
                                        Margin="0,0,4,0"
                                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}"/>
                                <Button Content="Delete" 
                                        Command="{Binding DeleteCommand}"
                                        Padding="5,2" 
                                        MinWidth="60"
                                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                            <Setter Property="Background" Value="#8B0000"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#A52A2A"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Status Bar -->
        <Border Grid.Row="5" 
                BorderBrush="{DynamicResource BrushBorder}" 
                BorderThickness="0,1,0,0" 
                Padding="10,5" 
                Margin="0,10,0,0"
                Background="{DynamicResource BrushSurfaceAlt}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="Status:"
                           FontWeight="Bold"
                           Foreground="{DynamicResource BrushTextPrimary}"
                           Margin="0,0,10,0"
                           VerticalAlignment="Center"/>

                <TextBlock Grid.Column="1" 
                           Text="{Binding StatusMessage}"
                           Foreground="{DynamicResource BrushTextSecondary}"
                           VerticalAlignment="Center"/>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="Bulk Import..." 
                            Command="{Binding BulkImportCommand}"
                            Padding="10,5"
                            MinWidth="100"
                            Margin="0,0,8,0"/>
                    <Button Content="Refresh" 
                            Command="{Binding RefreshCommand}"
                            Padding="10,5"
                            MinWidth="80"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
