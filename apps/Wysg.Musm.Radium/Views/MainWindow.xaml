<Window x:Class="Wysg.Musm.Radium.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:editor="clr-namespace:Wysg.Musm.Editor.Controls;assembly=Wysg.Musm.Editor"
        xmlns:rad="clr-namespace:Wysg.Musm.Radium.Controls"
        mc:Ignorable="d"
        Title="Radium - Medical Editor"
        Height="850" Width="1400"
        WindowStartupLocation="CenterScreen"
        Background="#111"
        FontFamily="Consolas"
        Foreground="#d0d0d0">

    <Window.Resources>
        <!-- Accent brushes -->
        <Color x:Key="AccentColor">#3D7BFD</Color>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="PanelBrush" Color="#1E1E1E"/>
        <SolidColorBrush x:Key="PanelAltBrush" Color="#252526"/>
        <SolidColorBrush x:Key="BorderBrushDark" Color="#2D2D30"/>
        <SolidColorBrush x:Key="GlyphBrush" Color="#808080"/>

        <!-- Base style for embedded AvalonEdit via MusmEditor inside EditorControl -->
        <Style TargetType="editor:MusmEditor">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="#DCDCDC"/>
            <Setter Property="BorderBrush" Value="#2D2D30"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontFamily" Value="Consolas"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="ShowLineNumbers" Value="True"/>
            <Setter Property="Padding" Value="4"/>
        </Style>

        <!-- Style for our wrapper EditorControl -->
        <Style TargetType="editor:EditorControl">
            <Setter Property="MinHeight" Value="120"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Background" Value="#1E1E1E"/>
        </Style>

        <Style TargetType="GridSplitter">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="ShowsPreview" Value="False"/>
        </Style>

        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="#C8C8C8"/>
            <Setter Property="Margin" Value="4,2,8,2"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="#C8C8C8"/>
            <Setter Property="BorderBrush" Value="#3D3D40"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="4,2,0,2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="2">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#232326"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#3D7BFD"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#808080"/>
                                <Setter TargetName="border" Property="Background" Value="#222"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="#808080"/>
        </Style>
        <Style TargetType="ListBox">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="BorderBrush" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="#D0D0D0"/>
        </Style>

        <Style x:Key="DarkToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="#C8C8C8"/>
            <Setter Property="BorderBrush" Value="#3D3D40"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="8,0,0,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="2">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3D3D40"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#5A9FD6"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#3D7BFD"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#808080"/>
                                <Setter TargetName="border" Property="Background" Value="#222"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="colFirst" Width="Auto" />
            <ColumnDefinition x:Name="colSecond" Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Central editing area -->
        <Grid Grid.Row="1" Grid.Column="1" Name="gridCenter" Background="#181818" Margin="0" HorizontalAlignment="Center" VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="4"/>
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Left: Current report -->
            <Grid Grid.Column="0" Margin="0">
                <Grid.RowDefinitions>
                    <!-- Fixed total height for two-row header area: 54px (32 + 22) -->
                    <RowDefinition Height="54"/>
                    <RowDefinition Height="4"/>
                    <RowDefinition Height="Auto" MinHeight="24"/>
                    <RowDefinition Height="4"/>
                    <RowDefinition Height="*" MinHeight="160"/>
                    <RowDefinition Height="4"/>
                    <RowDefinition Height="*" MinHeight="160"/>
                </Grid.RowDefinitions>

                <!-- Two-line header area: top buttons/toggles; bottom label -->
                <Grid Grid.Row="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="32"/>
                        <RowDefinition Height="22"/>
                    </Grid.RowDefinitions>

                    <!-- Upper row: controls (no scrollbar) -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="2,0,2,0" VerticalAlignment="Center">
                        <ToggleButton x:Name="btnStudyLocked"
                                      Content="Study locked"
                                      Margin="0,0,0,0"
                                      VerticalAlignment="Center"
                                      IsChecked="{Binding PatientLocked, Mode=TwoWay}"
                                      Style="{StaticResource DarkToggleButtonStyle}"/>
                        <ToggleButton x:Name="btnReportified"
                                      Content="Reportified"
                                      IsChecked="{Binding Reportified, Mode=TwoWay}"
                                      Style="{StaticResource DarkToggleButtonStyle}"/>
                        <Button Content="New Study" Command="{Binding NewStudyCommand}"/>
                        <Button Content="Send Report Preview" Command="{Binding SendReportPreviewCommand}"/>
                        <Button Content="Send Report" Command="{Binding SendReportCommand}"/>
                        <Button Content="Extract Phrases" Click="OnExtractPhrases"/>
                    </StackPanel>

                    <!-- Lower row: placeholder label for current study/patient detail -->
                    <TextBlock Grid.Row="1" Padding="2,2,0,0" Text="{Binding CurrentStudyLabel}" Foreground="#5A9FD6"/>
                </Grid>

                <GridSplitter Grid.Row="1" HorizontalAlignment="Stretch" Height="4"/>
                <editor:EditorControl x:Name="EditorHeader" Grid.Row="2" MinHeight="70" DocumentText="{Binding HeaderText, Mode=TwoWay}"/>
                <GridSplitter Grid.Row="3" HorizontalAlignment="Stretch" Height="4"/>
                <editor:EditorControl x:Name="EditorFindings" Grid.Row="4" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" DocumentText="{Binding FindingsText, Mode=TwoWay}"/>
                <GridSplitter Grid.Row="5" HorizontalAlignment="Stretch" Height="4"/>
                <editor:EditorControl x:Name="EditorConclusion" Grid.Row="6" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" DocumentText="{Binding ConclusionText, Mode=TwoWay}"/>
            </Grid>

            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Width="4" Background="#2D2D30"/>

            <!-- Right: Previous + suggestion -->
            <Grid Grid.Column="2" Margin="0">
                <Grid.RowDefinitions>
                    <!-- Fixed heights to match the left header two rows -->
                    <RowDefinition Height="32"/>
                    <RowDefinition Height="22"/>
                    <RowDefinition Height="4"/>
                    <RowDefinition Height="Auto" MinHeight="24"/>
                    <RowDefinition Height="4"/>
                    <RowDefinition Height="*" MinHeight="160"/>
                    <RowDefinition Height="4"/>
                    <RowDefinition Height="*" MinHeight="160"/>
                </Grid.RowDefinitions>

                <!-- Row 0: tabs + Add button at right, with overflow dropdown (no scrollbar) -->
                <rad:PreviousStudiesStrip Grid.Row="0"
                                          VerticalAlignment="Center"
                                          ItemsSource="{Binding PreviousStudies}"
                                          SelectCommand="{Binding SelectPreviousStudyCommand}"
                                          AddCommand="{Binding AddStudyCommand}"/>

                <!-- Row 1: selected previous study details (no scrollbar) -->
                <Border Grid.Row="1" Background="#1E1E1E" BorderBrush="#2D2D30" BorderThickness="1" Padding="6,2,6,2" Margin="0">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Previous study:" Foreground="#5A9FD6"/>
                        <TextBlock Text="{Binding SelectedPreviousStudy.Title}" Margin="8,0,0,0"/>
                        <TextBlock Text="{Binding SelectedPreviousStudy.StudyDateTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Margin="8,0,0,0"/>
                    </StackPanel>
                </Border>

                <GridSplitter Grid.Row="2" HorizontalAlignment="Stretch" Height="4"/>
                <editor:EditorControl x:Name="EditorPreviousHeader" Grid.Row="3" MinHeight="70" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" DocumentText="{Binding SelectedPreviousStudy.Header, Mode=TwoWay}"/>
                <GridSplitter Grid.Row="4" HorizontalAlignment="Stretch" Height="4"/>
                <editor:EditorControl x:Name="EditorPreviousFindings" Grid.Row="5" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" DocumentText="{Binding SelectedPreviousStudy.Findings, Mode=TwoWay}"/>
                <GridSplitter Grid.Row="6" HorizontalAlignment="Stretch" Height="4"/>
                <editor:EditorControl x:Name="EditorPreviousConclusion" Grid.Row="7" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" DocumentText="{Binding SelectedPreviousStudy.Conclusion, Mode=TwoWay}"/>
            </Grid>
        </Grid>

        <!-- Status bar (bottom) with two lines -->
        <Grid Grid.Row="2" Grid.ColumnSpan="2" Background="#1E1E1E" Margin="0,2,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Line 1: all buttons/toggles/inputs (trimmed after moving core actions above) -->
            <ScrollViewer Grid.Row="0" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <StackPanel Orientation="Horizontal" Margin="6,4,6,4">
                    <!-- Moved to header: New Study / Send Report Preview / Send Report -->
                    <Button Content="Manage studyname" Command="{Binding OpenStudynameMapCommand}"/>
                    <Button Content="Manage Phrases" Command="{Binding OpenPhraseManagerCommand}"/>

                    <Separator Width="10"/>

                    <Button Content="Force Ghost" Click="OnForceGhost"/>
                    <Button Content="Settings" Click="OnOpenSettings"/>
                    <Button Content="Spy" Click="OnOpenSpy"/>
                    <ToggleButton x:Name="tglAlignRight" Content="Align Right" Style="{StaticResource DarkToggleButtonStyle}" Margin="8,0,0,0" Checked="OnAlignRightToggled" Unchecked="OnAlignRightToggled"/>
                    <ToggleButton x:Name="chkReverseReports" Content="Reverse Reports" Style="{StaticResource DarkToggleButtonStyle}" Margin="8,0,0,0" Checked="OnReverseReportsChecked" Unchecked="OnReverseReportsChecked"/>

                    <TextBlock Text="HWND:" VerticalAlignment="Center" Margin="16,0,4,0"/>
                    <TextBox x:Name="txtPaneHwnd" Width="120" Height="22" Margin="0,0,6,0"/>
                    <Button Content="Auto Locate" Click="OnAutoLocate"/>
                    <Button Content="Read Banner (HWND)" Click="OnReadBannerByHwnd" Margin="6,0,0,0"/>
                    <Button Content="Read Banner (First Viewer)" Click="OnReadBannerFirstViewer" Margin="6,0,0,0"/>
                    <Button Content="Dump Strings (HWND)" Click="OnDumpStrings" Margin="6,0,0,0"/>
                    <ToggleButton x:Name="tglWatch" Content="Watch" Checked="OnWatchToggled" Unchecked="OnWatchToggled" Margin="6,0,0,0"/>
                    <Button Content="Read Banner (OCR)" Click="OnReadBannerOcr" Margin="6,0,0,0"/>

                    <Separator Width="10"/>
                    <TextBlock Text="Bookmark:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                    <TextBox x:Name="txtBookmarkName" Width="140" Height="22" Margin="0,0,6,0"/>
                    <Button Content="Save HWND" Click="OnBookmarkSave"/>
                    <Button Content="Resolve" Click="OnBookmarkResolve" Margin="6,0,0,0"/>

                    <TextBlock Text="L:" VerticalAlignment="Center" Margin="12,0,2,0"/>
                    <TextBox x:Name="txtCropL" Width="50" Height="22"/>
                    <TextBlock Text="T:" VerticalAlignment="Center" Margin="6,0,2,0"/>
                    <TextBox x:Name="txtCropT" Width="50" Height="22"/>
                    <TextBlock Text="W:" VerticalAlignment="Center" Margin="6,0,2,0"/>
                    <TextBox x:Name="txtCropW" Width="60" Height="22"/>
                    <TextBlock Text="H:" VerticalAlignment="Center" Margin="6,0,2,0"/>
                    <TextBox x:Name="txtCropH" Width="60" Height="22"/>
                    <Button Content="OCR (Fast)" Click="OnReadBannerOcrFast" Margin="6,0,0,0"/>
                    <Button Content="Log out" Click="OnLogout" Margin="12,0,6,0"/>
                    <TextBlock x:Name="txtUserEmail" VerticalAlignment="Center" Foreground="#C8C8C8"/>
                </StackPanel>
            </ScrollViewer>

            <!-- Line 2: copyable status text only -->
            <TextBox x:Name="txtStatus"
                     Grid.Row="1"
                     Margin="6,0,6,6"
                     IsReadOnly="True"
                     Background="#1E1E1E"
                     Foreground="#d0d0d0"
                     BorderBrush="#2D2D30"
                     BorderThickness="1"
                     TextWrapping="Wrap"
                     AcceptsReturn="True"
                     Height="60"
                     VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Disabled"
                     Text="Ready"/>
        </Grid>
    </Grid>
</Window>